---

- name: configure leader defaults
  sudo: yes
  template:
    src: master-defaults.j2
    dest: /etc/default/mesos-master
  notify:
    - restart mesos leader
  tags:
    - mesos

- name: delete leader credentials
  sudo: yes
  file:
    dest: /etc/mesos/credentials
    state: absent
  tags:
    - mesos

- name: Check if upstart exists
  stat: path=/etc/init/
  register: etc_init

- name: Check if systemd exists
  stat:
    path: '{{ systemd_system_path }}'
  register: systemd_check

- name: Mesos master upstart script
  template: src=init-mesos-master.j2 dest=/etc/init/mesos-master.conf
  when: etc_init.stat.exists == true and systemd_check.stat.exists == false
  notify:
    - restart mesos leader

- name: Mesos master systemd script
  template:
    src: mesos-master.service.j2
    dest: '{{ systemd_system_path }}/mesos-master.service'
  when: systemd_check.stat.exists == true
  notify:
    - restart mesos leader

- name: Restart Mesos master on boot using SystemV
  command: update-rc.d mesos-master enable
  when: etc_init.stat.exists == true and systemd_check.stat.exists == false

- name: Restart Mesos master on boot using systemd
  command: systemctl enable mesos-master
  args:
    creates: /lib/systemd/system/mesos-master.service
  when: systemd_check.stat.exists == true

# TODO set /etc/mesos-master/quorum or delete it
